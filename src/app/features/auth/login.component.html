<div class="login-root" role="presentation">
  <div class="backdrop" aria-hidden="true"></div>

  <div
    class="login-card"
    role="dialog"
    aria-modal="true"
    aria-labelledby="loginTitle"
  >
    <div class="card-header">
      <div class="app-badge">
        <img
          src="/images/Library Management S.png"
          alt="Library Management System logo"
          class="app-logo"
        />
      </div>
      <div class="header-text">
        <h1 class="title" id="loginTitle">Library Management System</h1>
        <p class="subtitle">Sign in to continue</p>
      </div>
    </div>

    <!-- Login Mode Toggle -->
    <div class="login-mode-toggle">
      <button
        type="button"
        class="toggle-btn"
        [class.active]="loginMode() === 'email'"
        (click)="setLoginMode('email')"
      >
        Email & Password
      </button>
      <button
        type="button"
        class="toggle-btn"
        [class.active]="loginMode() === 'qr'"
        (click)="setLoginMode('qr')"
      >
        QR Code
      </button>
    </div>

    <!-- Email/Password Login Form -->
    <form
      *ngIf="loginMode() === 'email'"
      [formGroup]="form"
      (ngSubmit)="submit()"
      class="form"
      novalidate
    >
      <label class="field">
        <span class="label">Email</span>
        <div class="control">
          <span class="control-icon" aria-hidden="true">âœ‰</span>
          <input
            type="email"
            formControlName="email"
            placeholder="name@example.edu"
            autocomplete="email"
            inputmode="email"
            [attr.aria-invalid]="
              form.controls.email.touched && form.controls.email.invalid
            "
            [class.invalid]="
              form.controls.email.touched && form.controls.email.invalid
            "
          />
        </div>
        <span
          class="error"
          *ngIf="form.controls.email.touched && form.controls.email.invalid"
        >
          Please enter a valid email.
        </span>
      </label>

      <label class="field">
        <span class="label">Password</span>
        <div class="password-row control">
          <span class="control-icon" aria-hidden="true">ðŸ”’</span>
          <input
            [type]="showPassword ? 'text' : 'password'"
            formControlName="password"
            placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"
            autocomplete="current-password"
            [attr.aria-invalid]="
              form.controls.password.touched && form.controls.password.invalid
            "
            [class.invalid]="
              form.controls.password.touched && form.controls.password.invalid
            "
          />
          <button
            type="button"
            class="btn-icon btn-ghost"
            (click)="togglePasswordVisibility()"
            [attr.aria-label]="showPassword ? 'Hide password' : 'Show password'"
          >
            <svg
              *ngIf="!showPassword; else eyeOffTpl"
              class="eye-icon"
              viewBox="0 0 24 24"
              aria-hidden="true"
              focusable="false"
            >
              <path
                d="M12 5C6.5 5 2.1 8.3 1 12c1.1 3.7 5.5 7 11 7s9.9-3.3 11-7c-1.1-3.7-5.5-7-11-7Zm0 12a5 5 0 1 1 0-10 5 5 0 0 1 0 10Zm0-2.5a2.5 2.5 0 1 0 0-5 2.5 2.5 0 0 0 0 5Z"
              />
            </svg>
            <ng-template #eyeOffTpl>
              <svg
                class="eye-icon"
                viewBox="0 0 24 24"
                aria-hidden="true"
                focusable="false"
              >
                <path
                  d="M2.1 3.51 3.51 2.1 21.9 20.49 20.49 21.9l-2.7-2.7A12.9 12.9 0 0 1 12 21C6.5 21 2.1 17.7 1 14c.56-1.9 1.82-3.69 3.6-5.14L2.1 3.51ZM7.1 11.36A4.99 4.99 0 0 0 12 19c1.23 0 2.37-.44 3.26-1.17l-1.6-1.6A2.49 2.49 0 0 1 12 16.5 2.5 2.5 0 0 1 9.5 14c0-.63.23-1.2.61-1.64l-3.01-3ZM12 7c3.75 0 7.06 2.14 8.48 5-.44 1.02-1.1 1.98-1.94 2.83l-2.07-2.07c.34-.55.53-1.2.53-1.86a5 5 0 0 0-5-5c-.66 0-1.3.19-1.86.53L8.26 4.58C9.43 4.2 10.7 4 12 4c5.5 0 9.9 3.3 11 7-.5 1.7-1.53 3.32-2.96 4.67l-1.42-1.42A10.38 10.38 0 0 0 23 11c-1.1-3.7-5.5-7-11-7-1.07 0-2.1.13-3.07.37l-1.6-1.6C8.72 2.28 10.32 2 12 2c5.5 0 9.9 3.3 11 7-.57 1.9-1.87 3.7-3.73 5.15l-1.44-1.44C19.21 11.5 15.84 9 12 9c-.52 0-1.02.05-1.5.14l-1.8-1.8C9.74 7.12 10.85 7 12 7Z"
                />
              </svg>
            </ng-template>
          </button>
        </div>
        <span
          class="error"
          *ngIf="form.controls.password.touched && form.controls.password.invalid"
        >
          Password is required.
        </span>
      </label>

      <button
        class="btn btn-primary"
        type="submit"
        [disabled]="isLoading()"
        [class.loading]="isLoading()"
        [attr.aria-busy]="isLoading()"
      >
        <span class="btn-inner">
          <span class="btn-spinner" aria-hidden="true"></span>
          <span class="btn-text" *ngIf="!isLoading(); else loadingTpl">Sign in</span>
          <ng-template #loadingTpl>
            <span class="btn-text">Signing in...</span>
          </ng-template>
        </span>
      </button>

      <div class="form-footer">
        <button
          type="button"
          class="link-button"
          (click)="goToForgotPassword()"
        >
          <span class="link-button-text">Forgot your password?</span>
          <span class="link-button-icon" aria-hidden="true">?</span>
        </button>
      </div>
    </form>

    <!-- QR Code Login -->
    <div *ngIf="loginMode() === 'qr'" class="qr-login-container">
      <app-qr-scanner
        title="Scan your QR code to login"
        hint="Position your QR code in front of the camera"
        (scanned)="onQrScanned($event)"
        (scanError)="onQrScanError($event)"
      ></app-qr-scanner>
    </div>

    <p class="error global-error" *ngIf="error()">
      {{ error() }}
    </p>
  </div>
</div>

